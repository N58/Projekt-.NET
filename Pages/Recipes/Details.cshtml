@page
@model PortalKulinarny.Pages.Recipes.DetailsModel

@{
    ViewData["Title"] = "Details";
}
<div>
    <div class="d-flex justify-content-between">
        <div>
            <h2 class="mr-3">@Html.DisplayFor(model => model.Recipe.Name)</h2>
        </div>
        <div>
            <h6 class="mr-3 d-inline align-middle">@Html.DisplayNameFor(model => model.Recipe.Rating): @Html.DisplayFor(model => model.Recipe.Rating)</h6>
            @if (!String.IsNullOrWhiteSpace(Model.UserId) && Model.UserId != Model.Recipe.UserId)
            {
                var vote = Model._voteService.FindVoteAsync(Model.Recipe.RecipeId, Model.UserId).Result;
                if (vote == null || vote.Value == -1)
                {
                    // Empty Like
                    <form class="mr-1 d-inline" method="post">
                        <button class="btn-icon gray" type="submit" asp-page-handler="UpVote" asp-route-id="@Model.Recipe.RecipeId"><i class="far fa-thumbs-up"></i></button>
                    </form>
                }
                else
                {
                    // Filled like
                    <form class="mr-1 d-inline" method="post">
                        <button class="btn-icon green" type="submit" asp-page-handler="UpVote" asp-route-id="@Model.Recipe.RecipeId"><i class="fas fa-thumbs-up"></i></button>
                    </form>
                }

                if (vote == null || vote.Value == 1)
                {
                    // Empty dislike
                    <form class="mr-3 d-inline" method="post">
                        <button class="btn-icon gray" type="submit" asp-page-handler="DownVote" asp-route-id="@Model.Recipe.RecipeId"><i class="far fa-thumbs-down"></i></button>
                    </form>
                }
                else
                {
                    // Filled dislike
                    <form class="mr-3 d-inline" method="post">
                        <button class="btn-icon red" type="submit" asp-page-handler="DownVote" asp-route-id="@Model.Recipe.RecipeId"><i class="fas fa-thumbs-down"></i></button>
                    </form>
                }
            }
            else if (!String.IsNullOrWhiteSpace(Model.UserId) && Model.UserId == Model.Recipe.UserId)
            {
                <a class="mr-1 d-inline btn btn-info" asp-page="./Edit" asp-route-id="@Model.Recipe.RecipeId">Edit</a>
                <a class="mr-3 d-inline btn btn-danger" asp-page="./Delete" asp-route-id="@Model.Recipe.RecipeId">Delete</a>
            }

            @if (!String.IsNullOrWhiteSpace(Model.UserId))
            {
                @if (await Model._favouritiesService.FindFavouriteAsync(Model.Recipe.RecipeId, Model.UserId) == null)
                {
                    <form class="d-inline" method="post">
                        <button class="btn-icon red" type="submit" asp-page-handler="Favourities" asp-route-id="@Model.Recipe.RecipeId"><i class="far fa-heart"></i></button>
                    </form>
                }
                else
                {
                    <form class="d-inline" method="post">
                        <button class="btn-icon red" type="submit" asp-page-handler="Favourities" asp-route-id="@Model.Recipe.RecipeId"><i class="fas fa-heart"></i></button>
                    </form>
                }

            }
        </div>
    </div>
    <hr />
    <div class="d-flex justify-content-between">
        <div>
            <h4>
                Autor: 
                <a class="a-link" asp-area="Identity" asp-page="/Account/Profile" asp-route-id="@Model.Recipe.UserId">
                    @await Model._userService.GetUserName(Model.Recipe.UserId)
                </a>
            </h4>
        </div>
        <div>
            <span><b>@Html.DisplayNameFor(model => model.Recipe.DateTime):</b> @Html.DisplayFor(model => model.Recipe.DateTime)</span>
            @{  
                // Ignoring miliseconds
                var d1 = Model.Recipe.DateTime;
                var d2 = Model.Recipe.ModificationDateTime;
                d1 = new DateTime(d1.Year, d1.Month, d1.Day, d1.Hour, d1.Minute, d1.Second, 0);
                d2 = new DateTime(d2.Year, d2.Month, d2.Day, d2.Hour, d2.Minute, d2.Second, 0);
                // Compare
                if (DateTime.Compare(d1, d2) != 0)
                {
                    <br /><span><b>@Html.DisplayNameFor(model => model.Recipe.ModificationDateTime):</b> @Html.DisplayFor(model => model.Recipe.ModificationDateTime)</span>
                }
            }
        </div>
    </div>

    <img class="rounded mx-auto d-block" style="margin: 20px; max-width: 100%;" src="https://ocdn.eu/pulscms-transforms/1/-E1k9kpTURBXy9jMzFlODhjYzk4YmMxNDhiODMyMzFiMzQ2ZGM2ZWI5My5qcGeTlQMAQs0ISc0EqZMFzQMUzQG8kwmmMjVhMjIxBoGhMAE/kotlet-schabowy.jpg" alt="Card image cap">
    
    <div class="container" style="margin: 20px;">
        <div class="row">
            <div class="col" style="max-width: 40%">
                <h5>@Html.DisplayNameFor(model => model.Recipe.Ingredients)</h5>
                <hr style="margin: 5px 0" />
                @foreach (var ingredient in Model.Recipe.Ingredients)
                {
                    <span>@ingredient.Name</span><hr style="margin: 5px 0" />
                }
            </div>
            <div class="col" style="max-width: 60%">
                <h5>@Html.DisplayNameFor(model => model.Recipe.Description)</h5>
                <span>@Html.DisplayFor(model => model.Recipe.Description)</span>
            </div>
        </div>
    </div>
</div>
<div class="d-flex justify-content-center" style="margin: 20px;">
    <a class="btn btn-primary" asp-page="./Index">Powrót</a>
</div>
